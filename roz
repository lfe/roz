#!/usr/bin/env bash

LIBS="ERL_LIBS=`lfetool info erllibs`"
LFE="$LIBS ./deps/lfe/bin/lfe -noshell"
LFEC="$LIBS ./deps/lfe/bin/lfec"
FINISH="-s erlang halt"

print-usage () {
    lfe
}

error () {
    message=$1
    echo
    echo $message
    echo
    print-usage $script
    exit 1
}

unknown-command-error () {
    command=$1
    error "Unknown command: '$command'";
}

do-repl () {
    echo "Starting roz REPL ..."
    echo
    make mnesia-shell
}

do-init () {
    echo "Initializing roz data ..."
    echo
    eval $LFE -s roz-script run roz init $FINISH
}

run () {
    script=$0
    command=$1
    case $command in
        -h|help)
            echo
            exit o
            ;;
        -v|version)
            echo
            exit 0
            ;;
        init)
            echo
            do-init
            exit 0
            ;;
        repl)
            do-repl
            ;;
        *)
            unknown-command-error $command
            ;;
    esac
}

run "$@"
